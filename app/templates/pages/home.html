{% extends "base.html" %}

{% block content %}

<!-- HERO: Impacto imediato -->
<section class="hero">
  <div class="container">
    <h1 class="hero__title">A desigualdade salarial do setor público, visualizada.</h1>
    <p class="hero__subtitle">
      Enquanto carreiras essenciais recebem pisos abaixo de R$ 6 mil,
      uma elite de 53 mil servidores custa R$ 20 bilhões acima do teto constitucional.
    </p>

    <div class="hero__stats">
      <div class="stat-card">
        <p class="stat-card__value">R$ {{ (custo_anual / 1000000000)|brl(0) }} bi</p>
        <p class="stat-card__label">Custo anual dos supersalários</p>
      </div>
      <div class="stat-card">
        <p class="stat-card__value">{{ servidores_acima|brl_int }}</p>
        <p class="stat-card__label">Servidores acima do teto</p>
      </div>
      <div class="stat-card">
        <p class="stat-card__value">R$ {{ teto|brl }}</p>
        <p class="stat-card__label">Teto constitucional</p>
      </div>
    </div>
  </div>
</section>

<!-- SEÇÃO: Comparação Visual (Feature principal) -->
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">Quem ganha quanto?</h2>
      <p class="section-header__subtitle">
        Compare a remuneração real de diferentes carreiras públicas.
        A linha laranja marca o teto constitucional de R$ {{ teto|brl }}.
      </p>
    </div>

    <!-- Barras de comparação (HTMX: recarregáveis por filtro) -->
    <div id="comparison-bars"
         hx-get="/api/fragment/comparison-bars"
         hx-trigger="load"
         hx-swap="innerHTML transition:true"
         hx-indicator="#bars-loading">

      <!-- Skeleton enquanto carrega -->
      <div id="bars-loading" class="htmx-indicator" style="display: flex; flex-direction: column; gap: 16px;">
        {% for i in range(8) %}
        <div style="padding: 8px;">
          <div class="skeleton" style="height: 16px; width: {{ 120 + i * 20 }}px; margin-bottom: 8px;"></div>
          <div class="skeleton" style="height: 28px; width: 100%;"></div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="source-badge mt-lg">
      <details style="font-size: 0.8rem;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--color-text-muted);">
          Ver todas as fontes e como cada valor foi obtido
        </summary>
        <div style="margin-top: var(--space-sm); padding: var(--space-md); background: var(--color-bg); border-radius: 8px; line-height: 1.8; overflow-x: auto; -webkit-overflow-scrolling: touch;">
          <table style="width: 100%; min-width: 600px; border-collapse: collapse; font-size: 0.8rem;">
            <thead>
              <tr style="text-align: left; border-bottom: 2px solid var(--color-border);">
                <th style="padding: 6px 8px;">Carreira</th>
                <th style="padding: 6px 8px;">Valor usado</th>
                <th style="padding: 6px 8px;">O que representa</th>
                <th style="padding: 6px 8px;">Fonte oficial</th>
              </tr>
            </thead>
            <tbody>
              {% for career in careers %}
              <tr style="border-bottom: 1px solid var(--color-border);">
                <td style="padding: 6px 8px; font-weight: 500;">{{ career.name }}</td>
                <td style="padding: 6px 8px;">R$ {{ career.salary_real|brl(0) }}</td>
                <td style="padding: 6px 8px; color: var(--color-text-muted);">
                  {% if career.penduricalhos > 0 %}
                    Base R$ {{ career.salary_base|brl(0) }} + penduricalhos R$ {{ career.penduricalhos|brl(0) }}
                  {% else %}
                    Piso/subsídio base (sem penduricalhos)
                  {% endif %}
                </td>
                <td style="padding: 6px 8px;">
                  <a href="{{ career.source_url }}" target="_blank" rel="noopener" style="color: var(--color-primary-light);">
                    {{ career.source }}
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <p style="margin-top: var(--space-sm); color: var(--color-text-muted); font-size: 0.75rem;">
            Cada link acima leva diretamente à fonte oficial. Clique para conferir o valor na origem.
            Para juízes e procuradores, o "salário real" inclui penduricalhos (auxílios, indenizações) reportados pelo
            <a href="https://dadosjusbr.org" target="_blank" rel="noopener" style="color: var(--color-primary-light);">DadosJusBr</a>.
          </p>
        </div>
      </details>
    </div>
  </div>
</section>

<!-- SEÇÃO: Raio-X (detalhe ao clicar em uma barra) -->
<section class="section" style="background: var(--color-bg);">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">Raio-X do contracheque</h2>
      <p class="section-header__subtitle">
        Clique em uma carreira acima para ver a decomposição: quanto é salário base e quanto são penduricalhos.
      </p>
    </div>

    <div id="career-detail">
      <!-- Preenchido via HTMX ao clicar em uma barra -->
      <div class="card text-center" style="padding: var(--space-2xl);">
        <p style="color: var(--color-text-muted);">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 16px; display: block; opacity: 0.4;">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
          Selecione uma carreira acima para ver o detalhamento.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- SEÇÃO: O Custo da Desigualdade -->
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">O custo da desigualdade</h2>
      <p class="section-header__subtitle">
        Com os R$ {{ (custo_anual / 1000000000)|brl(0) }} bilhões gastos em supersalários por ano,
        seria possível financiar:
      </p>
    </div>

    <div id="cost-calculator"
         hx-get="/api/fragment/cost-calculator"
         hx-trigger="load"
         hx-swap="innerHTML transition:true">
      <!-- Skeleton -->
      <div class="cost-grid">
        {% for i in range(4) %}
        <div class="cost-item">
          <div class="skeleton" style="height: 36px; width: 160px; margin-bottom: 8px;"></div>
          <div class="skeleton" style="height: 18px; width: 220px;"></div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- SEÇÃO: Comparação Internacional -->
<section class="section" style="background: var(--color-bg);">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">E no resto do mundo?</h2>
      <p class="section-header__subtitle">
        Proporção juiz/professor: no Brasil um juiz ganha <strong>15,9x</strong> mais que um professor.
        Na Alemanha, essa proporção é de <strong>1,5x</strong>.
      </p>
    </div>

    <div class="grid grid--2" style="gap: var(--space-lg); grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
      {% for country in international %}
      <div class="card" style="text-align: center; padding: var(--space-md) var(--space-sm);">
        <p style="font-size: 1.75rem; margin-bottom: var(--space-xs);">{{ country.flag }}</p>
        <p style="font-weight: 700; font-size: 1rem; margin-bottom: var(--space-xs);">{{ country.country }}</p>
        <p style="font-size: 1.75rem; font-weight: 800; color: {% if country.ratio > 10 %}var(--color-danger){% elif country.ratio > 3 %}var(--color-warning){% else %}var(--color-success){% endif %};">
          {{ country.ratio }}x
        </p>
        <p class="text-muted" style="font-size: 0.75rem;">juiz vs professor</p>
        <div style="margin-top: var(--space-sm); font-size: 0.75rem; text-align: left;">
          <p><strong>Juiz:</strong> R$ {{ country.judge_salary_brl|brl(0) }}
            {% if country.original_currency and country.original_currency != 'BRL' %}
            <span class="text-muted">({{ country.original_currency }} {{ country.judge_original|brl(0) }})</span>
            {% endif %}
          </p>
          <p><strong>Prof:</strong> R$ {{ country.teacher_salary_brl|brl(0) }}
            {% if country.original_currency and country.original_currency != 'BRL' %}
            <span class="text-muted">({{ country.original_currency }} {{ country.teacher_original|brl(0) }})</span>
            {% endif %}
          </p>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Insights da comparação internacional -->
    {% if international|length > 2 %}
    {% set maior = international|first %}
    {% set menor = international|last %}
    <div class="card mt-lg" style="padding: var(--space-lg); background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-bg) 100%); border-left: 4px solid var(--color-accent);">
      <h3 style="font-size: 1rem; margin-bottom: var(--space-sm); color: var(--color-primary);">
        O que os números mostram
      </h3>
      <div style="font-size: 0.9rem; line-height: 1.7;">
        <p>
          <strong style="color: var(--color-danger);">{{ maior.flag }} {{ maior.country }}</strong> lidera a desigualdade:
          um juiz ganha <strong>{{ maior.ratio }}x</strong> mais que um professor.
          No outro extremo, <strong style="color: var(--color-success);">{{ menor.flag }} {{ menor.country }}</strong> tem a menor diferença,
          com proporção de <strong>{{ menor.ratio }}x</strong>.
        </p>
        <p style="margin-bottom: 0;">
          Isso significa que a desigualdade salarial entre juízes e professores no {{ maior.country }} é
          <strong>{{ (maior.ratio / menor.ratio)|round(1) }}x maior</strong> que na {{ menor.country }}.
          {% if maior.country == 'Brasil' %}
          O Brasil está na posição mais desigual entre todos os países analisados.
          {% endif %}
        </p>
      </div>
    </div>
    {% endif %}

    <!-- Cotações em tempo real -->
    {% if exchange_rates %}
    <details class="mt-lg">
      <summary class="card" style="padding: var(--space-sm) var(--space-md); cursor: pointer; font-size: 0.85rem; font-weight: 600; color: var(--color-text-muted); list-style: none; display: flex; align-items: center; gap: var(--space-sm);">
        <span>Câmbio usado ({{ exchange_rates|length }} moedas)</span>
        <span style="font-weight: 400; font-size: 0.75rem;">— clique para expandir</span>
      </summary>
      <div class="card" style="padding: var(--space-md); margin-top: 4px; display: flex; flex-wrap: wrap; gap: var(--space-sm) var(--space-lg); font-size: 0.8rem;">
        {% for currency, rate in exchange_rates.items() %}
        <span style="display: inline-flex; align-items: center; gap: 4px; white-space: nowrap;">
          {{ rate.flag }}
          <strong>{{ currency }}:</strong>
          R$ {{ rate.rate|brl(4) }}
        </span>
        {% endfor %}
        <span class="text-muted" style="font-size: 0.7rem; width: 100%; display: block;">
          Fonte:
          {% if exchange_rates.values()|list and exchange_rates.values()|list|first %}
            <a href="{{ (exchange_rates.values()|list|first).source_url }}" target="_blank" rel="noopener">
              {{ (exchange_rates.values()|list|first).source }}
            </a>
          {% endif %}
        </span>
      </div>
    </details>
    {% endif %}

    <div class="source-badge mt-lg">
      <span>Fontes:</span>
      <a href="https://dadosjusbr.org" target="_blank" rel="noopener">DadosJusBr</a> ·
      <a href="https://www.uscourts.gov/judges-judgeships/judicial-compensation" target="_blank" rel="noopener">US Courts</a> ·
      <a href="https://www.oecd.org/gov/government-at-a-glance/" target="_blank" rel="noopener">OECD</a> ·
      <a href="https://economia.awesomeapi.com.br" target="_blank" rel="noopener">AwesomeAPI</a> ·
      <a href="https://dadosabertos.bcb.gov.br" target="_blank" rel="noopener">BCB PTAX</a>
      <span class="text-muted" style="font-size: 0.75rem; display: block; margin-top: 4px;">
        Valores internacionais convertidos para R$ com câmbio atualizado em tempo real. Comparação aproximada — fontes detalhadas ao passar o mouse sobre cada card.
      </span>
    </div>
  </div>
</section>

<!-- SEÇÃO: Transparência e Auditabilidade -->
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">Transparência e auditabilidade</h2>
      <p class="section-header__subtitle">
        Todos os dados podem ser verificados nas fontes originais. O OctoWage apenas agrega e visualiza informações públicas.
      </p>
    </div>

    <div class="card" style="padding: var(--space-lg);">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-lg);">

        <div>
          <h3 style="font-size: 1rem; margin-bottom: var(--space-sm);">Fontes de dados</h3>
          <ul style="list-style: none; display: flex; flex-direction: column; gap: var(--space-xs); font-size: 0.85rem;">
            <li>
              <a href="https://dadosjusbr.org" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">DadosJusBr</a>
              — Remuneração do Judiciário e Ministério Público
            </li>
            <li>
              <a href="https://portaldatransparencia.gov.br" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">Portal da Transparência</a>
              — Servidores do Executivo Federal
            </li>
            <li>
              <a href="https://www.gov.br/mec" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">MEC</a>
              — Piso nacional do magistério (Portaria 82/2026)
            </li>
            <li>
              <a href="https://republica.org" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">República.org</a>
              — Pesquisa sobre supersalários (Mov. Pessoas à Frente)
            </li>
            <li>
              <a href="https://economia.awesomeapi.com.br" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">AwesomeAPI</a> /
              <a href="https://dadosabertos.bcb.gov.br" target="_blank" rel="noopener" style="color: var(--color-primary-light); font-weight: 500;">BCB PTAX</a>
              — Cotações de câmbio em tempo real
            </li>
          </ul>
        </div>

        <div>
          <h3 style="font-size: 1rem; margin-bottom: var(--space-sm);">Como auditar</h3>
          <ol style="padding-left: 1.2rem; display: flex; flex-direction: column; gap: var(--space-xs); font-size: 0.85rem;">
            <li>Cada valor exibido tem a <strong>fonte original</strong> linkada</li>
            <li>Clique na fonte para verificar diretamente no site oficial</li>
            <li>A cotação de câmbio mostra <strong>API, valor e horário</strong> da atualização</li>
            <li>O código-fonte é <a href="https://github.com/BrunnoML/OctoWage" target="_blank" rel="noopener" style="color: var(--color-primary-light);">aberto no GitHub</a> para auditoria completa</li>
            <li>Encontrou erro? <a href="https://github.com/BrunnoML/OctoWage/issues" target="_blank" rel="noopener" style="color: var(--color-primary-light);">Abra uma issue</a> com a correção</li>
          </ol>
        </div>

      </div>

      <p class="text-muted" style="font-size: 0.75rem; margin-top: var(--space-lg); padding-top: var(--space-md); border-top: 1px solid var(--color-border);">
        O OctoWage não tem vinculação com nenhum órgão governamental. Dados públicos amparados pela
        <abbr title="Lei de Acesso à Informação">LAI</abbr> (Lei 12.527/2011) e
        <abbr title="Supremo Tribunal Federal">STF</abbr> Tema 483 (ARE 652.777/SP).
        Não exibimos dados pessoais sensíveis (CPF, endereço, saúde). Trabalhamos apenas com dados agregados por carreira.
      </p>
    </div>
  </div>
</section>

<!-- SEÇÃO: Comparador dinâmico -->
<section class="section text-center">
  <div class="container">
    <h2>Compare carreiras lado a lado</h2>
    <p class="text-muted mb-lg" style="max-width: 680px; margin-left: auto; margin-right: auto;">
      Escolha duas carreiras e veja a diferença de salário, formação exigida, jornada e risco ocupacional.
    </p>

    <!-- Seletor dinâmico -->
    <div class="card" style="padding: var(--space-lg); max-width: 640px; margin: 0 auto;">
      <div style="display: flex; flex-wrap: wrap; align-items: end; gap: var(--space-md); justify-content: center;">
        <div style="flex: 1; min-width: 180px; text-align: left;">
          <label for="career-select-1" style="display: block; font-size: 0.8rem; font-weight: 600; color: var(--color-text-muted); margin-bottom: var(--space-xs);">Carreira 1</label>
          <select id="career-select-1" style="width: 100%; padding: 10px 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 0.95rem; background: var(--color-surface); color: var(--color-text); cursor: pointer;">
            {% for career in careers %}
            <option value="{{ career.id }}" {% if career.id == 'professor' %}selected{% endif %}>{{ career.name }} — R$ {{ career.salary_real|brl(0) }}</option>
            {% endfor %}
          </select>
        </div>

        <span style="font-weight: 700; font-size: 1.1rem; color: var(--color-text-muted); padding-bottom: 8px;">vs</span>

        <div style="flex: 1; min-width: 180px; text-align: left;">
          <label for="career-select-2" style="display: block; font-size: 0.8rem; font-weight: 600; color: var(--color-text-muted); margin-bottom: var(--space-xs);">Carreira 2</label>
          <select id="career-select-2" style="width: 100%; padding: 10px 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 0.95rem; background: var(--color-surface); color: var(--color-text); cursor: pointer;">
            {% for career in careers %}
            <option value="{{ career.id }}" {% if career.id == 'juiz_media' %}selected{% endif %}>{{ career.name }} — R$ {{ career.salary_real|brl(0) }}</option>
            {% endfor %}
          </select>
        </div>

        <button id="btn-compare" class="btn btn--primary" style="padding: 10px 24px; white-space: nowrap;" onclick="compareCareiras()">
          Comparar
        </button>
      </div>

      <p id="compare-error" style="color: var(--color-danger); font-size: 0.8rem; margin-top: var(--space-sm); display: none;">
        Selecione duas carreiras diferentes para comparar.
      </p>
    </div>

    <!-- Sugestões rápidas -->
    <div style="margin-top: var(--space-lg);">
      <p class="text-muted" style="font-size: 0.8rem; margin-bottom: var(--space-sm);">Comparações populares:</p>
      <div class="flex flex--center flex--wrap flex--gap-sm">
        <a href="/comparar/professor-vs-juiz_media" class="btn btn--outline" style="font-size: 0.85rem;">Professor vs Juiz</a>
        <a href="/comparar/enfermeiro-vs-procurador_mp" class="btn btn--outline" style="font-size: 0.85rem;">Enfermeiro vs Procurador</a>
        <a href="/comparar/soldado_pm-vs-juiz_tjsp" class="btn btn--outline" style="font-size: 0.85rem;">Soldado PM vs Juiz TJSP</a>
      </div>
    </div>

    <!-- Sugira uma carreira -->
    <div class="card mt-lg" style="padding: var(--space-lg); border: 2px dashed var(--color-border); background: var(--color-bg); max-width: 640px; margin-left: auto; margin-right: auto;">
      <p style="font-size: 1.25rem; margin-bottom: var(--space-xs);">
        Sentiu falta de alguma carreira?
      </p>
      <p class="text-muted" style="font-size: 0.85rem;">
        Técnico judiciário, analista, coronel PM, perito criminal, médico do SUS...
        Sugira novas carreiras para incluirmos nas comparações. Basta abrir uma issue no GitHub com o nome do cargo e a fonte oficial do salário.
      </p>
      <a href="https://github.com/BrunnoML/OctoWage/issues/new?title=Sugest%C3%A3o%20de%20carreira%3A%20%5Bnome%20do%20cargo%5D&body=**Carreira%20sugerida%3A**%20%0A%0A**Sal%C3%A1rio%20base%3A**%20R%24%20%0A%0A**Fonte%20oficial%3A**%20%0A%0A**Observa%C3%A7%C3%B5es%3A**%20" target="_blank" rel="noopener" class="btn btn--outline" style="font-size: 0.85rem; margin-top: var(--space-sm);">
        Sugerir carreira
      </a>
    </div>
  </div>
</section>

<script>
function compareCareiras() {
  var c1 = document.getElementById('career-select-1').value;
  var c2 = document.getElementById('career-select-2').value;
  var err = document.getElementById('compare-error');
  if (c1 === c2) {
    err.style.display = 'block';
    return;
  }
  err.style.display = 'none';
  window.location.href = '/comparar/' + c1 + '-vs-' + c2;
}
</script>

{% endblock %}
