{% extends "base.html" %}

{% block content %}

<section class="section">
  <div class="container">
    <div class="section-header text-center">
      <h1 class="section-header__title">{{ career1.name }} vs {{ career2.name }}</h1>
      <p class="section-header__subtitle" style="margin: 0 auto;">
        Comparação detalhada: salário, formação, jornada e risco.
      </p>
    </div>

    <!-- Seletor dinâmico para nova comparação -->
    <div class="card mt-lg" style="padding: var(--space-md) var(--space-lg); max-width: 700px; margin-left: auto; margin-right: auto; background: var(--color-bg); border: 1px solid var(--color-border);">
      <p class="text-muted text-center" style="font-size: 0.8rem; margin-bottom: var(--space-sm);">Trocar comparação:</p>
      <div style="display: flex; flex-wrap: wrap; align-items: end; gap: var(--space-sm); justify-content: center;">
        <div style="flex: 1; min-width: 160px;">
          <select id="career-select-1" aria-label="Carreira 1" style="width: 100%; padding: 8px 10px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 0.9rem; background: var(--color-surface); color: var(--color-text); cursor: pointer;">
            {% for career in careers %}
            <option value="{{ career.id }}" {% if career.id == career1.id %}selected{% endif %}>{{ career.name }}</option>
            {% endfor %}
          </select>
        </div>

        <span style="font-weight: 700; font-size: 1rem; color: var(--color-text-muted); padding-bottom: 6px;">vs</span>

        <div style="flex: 1; min-width: 160px;">
          <select id="career-select-2" aria-label="Carreira 2" style="width: 100%; padding: 8px 10px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 0.9rem; background: var(--color-surface); color: var(--color-text); cursor: pointer;">
            {% for career in careers %}
            <option value="{{ career.id }}" {% if career.id == career2.id %}selected{% endif %}>{{ career.name }}</option>
            {% endfor %}
          </select>
        </div>

        <button class="btn btn--primary" style="padding: 8px 20px; white-space: nowrap;" onclick="compareCareiras()">
          Comparar
        </button>
      </div>
      <p id="compare-error" style="color: var(--color-danger); font-size: 0.8rem; margin-top: var(--space-xs); display: none; text-align: center;">
        Selecione duas carreiras diferentes.
      </p>
    </div>

    <!-- Comparação visual lado a lado -->
    <div class="compare-layout mt-xl">

      <!-- Carreira 1 -->
      <div class="compare-panel compare-panel--left">
        <h3 style="margin-bottom: var(--space-sm);">{{ career1.name }}</h3>
        <p class="money money--large" style="color: var(--color-primary-light);">
          R$ {{ career1.salary_real|brl(0) }}<span class="text-muted" style="font-size: 0.8rem;">/mês</span>
        </p>

        <div style="margin-top: var(--space-lg); display: flex; flex-direction: column; gap: var(--space-md);">
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Salário base</p>
            <p class="money">R$ {{ career1.salary_base|brl(0) }}</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Penduricalhos</p>
            <p class="money {% if career1.penduricalhos > 0 %}money--danger{% endif %}">
              R$ {{ career1.penduricalhos|brl(0) }}
            </p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Formação</p>
            <p style="font-weight: 500;">{{ career1.education }}</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Jornada</p>
            <p style="font-weight: 500;">{{ career1.weekly_hours }}h/semana</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Risco ocupacional</p>
            <span class="risk-tag risk-tag--{{ career1.risk_level }}">
              {{ career1.risk_assessment.level_display }} ({{ career1.risk_assessment.score }} pts)
            </span>
            <details style="margin-top: 6px; font-size: 0.75rem;">
              <summary style="cursor: pointer; color: var(--color-primary-light);">Ver metodologia</summary>
              <div style="margin-top: 8px; padding: 8px; background: var(--color-bg); border-radius: 6px;">
                <p style="margin-bottom: 6px;">
                  <strong>Adicional legal:</strong> {{ career1.risk_assessment.adicional_legal }} pts
                  {% if career1.risk_assessment.adicional_legal == 2 %}(periculosidade 30%){% elif career1.risk_assessment.adicional_legal == 1 %}(insalubridade){% else %}(sem adicional){% endif %}
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Mortalidade:</strong> {{ career1.risk_assessment.mortalidade }} pts
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Exposição a violência:</strong> {{ career1.risk_assessment.exposicao_violencia }} pts
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Jornada/condições:</strong> {{ career1.risk_assessment.jornada_condicoes }} pts
                </p>
                <p style="margin-top: 8px; color: var(--color-text-muted); font-style: italic;">
                  {{ career1.risk_assessment.justificativa }}
                </p>
                <p style="margin-top: 6px;"><strong>Fontes:</strong></p>
                <ul style="margin: 4px 0 0 16px;">
                  {% for fonte in career1.risk_assessment.fontes %}
                  <li><a href="{{ fonte.url }}" target="_blank" rel="noopener" style="color: var(--color-primary-light);">{{ fonte.nome }}</a></li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">vs Teto</p>
            <p style="font-weight: 500;">{{ '{:.0f}'.format(career1.salary_real / teto * 100) }}%</p>
          </div>
          <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--color-border);">
            <p class="text-muted" style="font-size: 0.75rem;">
              Fonte: <a href="{{ career1.source_url }}" target="_blank" rel="noopener" style="color: var(--color-primary-light);">{{ career1.source }}</a>
            </p>
          </div>
        </div>
      </div>

      <!-- VS (mobile) -->
      <div class="compare-vs">VS</div>

      <!-- Carreira 2 -->
      <div class="compare-panel compare-panel--right">
        <h3 style="margin-bottom: var(--space-sm);">{{ career2.name }}</h3>
        <p class="money money--large {% if career2.salary_real > teto %}money--danger{% endif %}">
          R$ {{ career2.salary_real|brl(0) }}<span class="text-muted" style="font-size: 0.8rem;">/mês</span>
        </p>

        <div style="margin-top: var(--space-lg); display: flex; flex-direction: column; gap: var(--space-md);">
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Salário base</p>
            <p class="money">R$ {{ career2.salary_base|brl(0) }}</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Penduricalhos</p>
            <p class="money {% if career2.penduricalhos > 0 %}money--danger{% endif %}">
              R$ {{ career2.penduricalhos|brl(0) }}
            </p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Formação</p>
            <p style="font-weight: 500;">{{ career2.education }}</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Jornada</p>
            <p style="font-weight: 500;">{{ career2.weekly_hours }}h/semana</p>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">Risco ocupacional</p>
            <span class="risk-tag risk-tag--{{ career2.risk_level }}">
              {{ career2.risk_assessment.level_display }} ({{ career2.risk_assessment.score }} pts)
            </span>
            <details style="margin-top: 6px; font-size: 0.75rem;">
              <summary style="cursor: pointer; color: var(--color-primary-light);">Ver metodologia</summary>
              <div style="margin-top: 8px; padding: 8px; background: var(--color-bg); border-radius: 6px;">
                <p style="margin-bottom: 6px;">
                  <strong>Adicional legal:</strong> {{ career2.risk_assessment.adicional_legal }} pts
                  {% if career2.risk_assessment.adicional_legal == 2 %}(periculosidade 30%){% elif career2.risk_assessment.adicional_legal == 1 %}(insalubridade){% else %}(sem adicional){% endif %}
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Mortalidade:</strong> {{ career2.risk_assessment.mortalidade }} pts
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Exposição a violência:</strong> {{ career2.risk_assessment.exposicao_violencia }} pts
                </p>
                <p style="margin-bottom: 6px;">
                  <strong>Jornada/condições:</strong> {{ career2.risk_assessment.jornada_condicoes }} pts
                </p>
                <p style="margin-top: 8px; color: var(--color-text-muted); font-style: italic;">
                  {{ career2.risk_assessment.justificativa }}
                </p>
                <p style="margin-top: 6px;"><strong>Fontes:</strong></p>
                <ul style="margin: 4px 0 0 16px;">
                  {% for fonte in career2.risk_assessment.fontes %}
                  <li><a href="{{ fonte.url }}" target="_blank" rel="noopener" style="color: var(--color-primary-light);">{{ fonte.nome }}</a></li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          </div>
          <div>
            <p class="text-muted" style="font-size: 0.8rem;">vs Teto</p>
            <p style="font-weight: 500;">{{ '{:.0f}'.format(career2.salary_real / teto * 100) }}%</p>
          </div>
          <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--color-border);">
            <p class="text-muted" style="font-size: 0.75rem;">
              Fonte: <a href="{{ career2.source_url }}" target="_blank" rel="noopener" style="color: var(--color-primary-light);">{{ career2.source }}</a>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumo da diferença -->
    <div class="card mt-xl text-center" style="border: 2px solid var(--color-border);">
      {% set razao = (career2.salary_real / career1.salary_real) if career2.salary_real > career1.salary_real else (career1.salary_real / career2.salary_real) %}
      {% set maior = career2 if career2.salary_real > career1.salary_real else career1 %}
      {% set menor = career1 if career2.salary_real > career1.salary_real else career2 %}

      <p style="font-size: 0.9rem; color: var(--color-text-muted);">
        Um(a) <strong>{{ maior.name }}</strong> recebe
      </p>
      <p class="money money--large money--danger" style="margin: var(--space-sm) 0;">
        {{ '{:.1f}'.format(razao) }}x mais
      </p>
      <p style="font-size: 0.9rem; color: var(--color-text-muted);">
        que um(a) <strong>{{ menor.name }}</strong>.
        A diferença mensal é de <strong class="money">R$ {{ (maior.salary_real - menor.salary_real)|brl(0) }}</strong>.
      </p>
    </div>

    <!-- Nota metodológica de risco -->
    <div class="card mt-lg" style="background: var(--color-bg); border: 1px solid var(--color-border);">
      <details>
        <summary style="cursor: pointer; font-weight: 600; font-size: 0.9rem; padding: var(--space-sm);">
          Como calculamos o risco ocupacional?
        </summary>
        <div style="padding: 0 var(--space-md) var(--space-md); font-size: 0.85rem; line-height: 1.6;">
          <p style="margin-bottom: var(--space-sm);">
            O OctoWage usa a <strong>Metodologia de Risco Ocupacional v1.0</strong>, baseada em 4 indicadores objetivos com fontes oficiais:
          </p>
          <table style="width: 100%; border-collapse: collapse; margin: var(--space-sm) 0; font-size: 0.8rem;">
            <thead>
              <tr style="background: var(--color-surface); text-align: left;">
                <th style="padding: 8px; border-bottom: 2px solid var(--color-border);">Indicador</th>
                <th style="padding: 8px; border-bottom: 2px solid var(--color-border);">Pontos</th>
                <th style="padding: 8px; border-bottom: 2px solid var(--color-border);">Fonte</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">Adicional legal (periculosidade/insalubridade)</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">0-2</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">CLT Art. 193-195, NR-15, NR-16</td>
              </tr>
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">Mortalidade em serviço</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">0-3</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">FBSP 19º Anuário (2025), COFEN</td>
              </tr>
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">Exposição a violência/agentes nocivos</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">0-2</td>
                <td style="padding: 8px; border-bottom: 1px solid var(--color-border);">NR-15, NR-16, regulamentos</td>
              </tr>
              <tr>
                <td style="padding: 8px;">Jornada e condições adversas</td>
                <td style="padding: 8px;">0-1</td>
                <td style="padding: 8px;">CLT, estatutos das carreiras</td>
              </tr>
            </tbody>
          </table>
          <p>
            <strong>Classificação:</strong> Baixo (0-1 pts) · Médio (2-3 pts) · Alto (4-5 pts) · Muito Alto (6+ pts)
          </p>
          <p style="margin-top: var(--space-sm); color: var(--color-text-muted);">
            Esta metodologia foi desenvolvida pelo OctoWage com base em legislação trabalhista brasileira e dados do
            <a href="https://forumseguranca.org.br/publicacoes/anuario-brasileiro-de-seguranca-publica/" target="_blank" rel="noopener" style="color: var(--color-primary-light);">Fórum Brasileiro de Segurança Pública</a>.
            Não é uma classificação oficial do governo — é uma ferramenta de comparação para o cidadão.
            <a href="/sobre#metodologia-risco" style="color: var(--color-primary-light);">Saiba mais na página Sobre</a>.
          </p>
        </div>
      </details>
    </div>

    <!-- Outras comparações populares -->
    <div class="mt-xl text-center">
      <p class="text-muted mb-md" style="font-size: 0.85rem;">Comparações populares:</p>
      <div class="flex flex--center flex--wrap flex--gap-sm">
        <a href="/comparar/professor-vs-juiz_media" class="btn btn--sm btn--outline">Professor vs Juiz</a>
        <a href="/comparar/enfermeiro-vs-procurador_mp" class="btn btn--sm btn--outline">Enfermeiro vs Procurador</a>
        <a href="/comparar/soldado_pm-vs-juiz_tjsp" class="btn btn--sm btn--outline">Soldado PM vs Juiz TJSP</a>
        <a href="/comparar/agente_pc-vs-agente_pf" class="btn btn--sm btn--outline">Agente PC vs Agente PF</a>
        <a href="/comparar/agente_pf-vs-delegado_pf" class="btn btn--sm btn--outline">Agente PF vs Delegado PF</a>
        <a href="/comparar/agente_pc-vs-delegado_pc" class="btn btn--sm btn--outline">Agente PC vs Delegado PC</a>
      </div>
    </div>

    <!-- Sugira uma carreira -->
    <div class="card mt-lg text-center" style="padding: var(--space-lg); border: 2px dashed var(--color-border); background: var(--color-bg); max-width: 640px; margin-left: auto; margin-right: auto;">
      <p style="font-size: 1.1rem; margin-bottom: var(--space-xs);">
        Sentiu falta de alguma carreira?
      </p>
      <p class="text-muted" style="font-size: 0.85rem;">
        Sugira novas carreiras para incluirmos nas comparações.
      </p>
      <a href="https://github.com/BrunnoML/OctoWage/issues/new?title=Sugest%C3%A3o%20de%20carreira%3A%20%5Bnome%20do%20cargo%5D&body=**Carreira%20sugerida%3A**%20%0A%0A**Sal%C3%A1rio%20base%3A**%20R%24%20%0A%0A**Fonte%20oficial%3A**%20%0A%0A**Observa%C3%A7%C3%B5es%3A**%20" target="_blank" rel="noopener" class="btn btn--outline" style="font-size: 0.85rem; margin-top: var(--space-sm);">
        Sugerir carreira
      </a>
    </div>

  </div>
</section>

<script>
function compareCareiras() {
  var c1 = document.getElementById('career-select-1').value;
  var c2 = document.getElementById('career-select-2').value;
  var err = document.getElementById('compare-error');
  if (c1 === c2) {
    err.style.display = 'block';
    return;
  }
  err.style.display = 'none';
  window.location.href = '/comparar/' + c1 + '-vs-' + c2;
}
</script>

{% endblock %}
